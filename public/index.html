<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FosterTrack Prototype</title>

  <!-- Google Font for nicer typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-body: #eef3f7;
      --phone-bg: #fdfdfd;
      --accent: #3a7f7b;
      --accent-soft: #e1f2f0;
      --accent-strong: #25524f;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --card-bg: #f3f4f6;
      --border-subtle: #e0e4ea;
      --danger: #d11a2a;
      --pill-bg: #e6f0ef;
      --pill-border: #b7cfcb;
    }

    * {
      box-sizing: border-box;
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #f6fbff 0, #eef3f7 40%, #e1e5ee 100%);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 30px 0;          /* space above and below phone */
      min-height: 100vh;
      box-sizing: border-box;
    }

    .phone {
      width: 390px;
      height: 844px;
      border-radius: 40px;
      border: 10px solid #111827;
      background: var(--phone-bg);
      overflow: hidden;
      position: relative;
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.28),
        0 0 0 1px rgba(148, 163, 184, 0.35);

      /* Scale so the phone always fits inside the viewport
         with some margin around it */
      transform: scale(
        calc(
          min(
            (100vh - 60px) / 844,
            (100vw - 40px) / 390
          )
        )
      );
      transform-origin: top center;
    }

    .screen {
      width: 100%;
      height: 100%;
      padding: 28px 22px 80px;
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      background: radial-gradient(circle at top, #f9fbff 0, #f6f7fb 55%, #f1f2f6 100%);
    }
    .screen.active { display: block; }

    h1, h2, h3 {
      margin: 0 0 4px;
      font-size: 22px;
      letter-spacing: 0.02em;
      color: var(--text-main);
    }

    .screen > p {
      margin: 0 0 16px;
      font-size: 14px;
      color: var(--text-muted);
    }

    label {
      font-size: 13px;
      display: block;
      margin-bottom: 4px;
      color: var(--text-muted);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    input, textarea, select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: #f4f5f7;
      font-size: 14px;
      color: var(--text-main);
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(58, 127, 123, 0.2);
    }

    textarea { resize: none; min-height: 90px;}

    .row {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }
    .row > .field { flex: 1; }
    .field { margin-bottom: 14px; }

    .button-row {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      gap: 10px;
    }

    button {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      padding: 10px 20px;
      font-size: 15px;
      font-weight: 600;
      transition: transform 0.08s ease, box-shadow 0.12s ease, background 0.15s ease;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
      box-shadow: 0 6px 16px rgba(58, 127, 123, 0.35);
    }

    .btn-primary:hover {
      background: var(--accent-strong);
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(37, 82, 79, 0.4);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-secondary:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }

    .cat-list {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .cat-card {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      background: #ffffff;
      border-radius: 14px;
      cursor: pointer;
      gap: 10px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
      transition: transform 0.08s ease, box-shadow 0.12s ease, border-color 0.12s ease;
    }

    .cat-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.12);
      border-color: rgba(58, 127, 123, 0.4);
    }

    .thumb {
      width: 56px;
      height: 56px;
      background: #ffffff;   /* white background behind icon */
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .cat-icon {
      width: 32px;
      height: 32px;
      fill: var(--accent-strong);
    }

    .cat-name {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-main);
    }

    .cat-subinfo {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .delete-btn {
      margin-left: auto;
      border: none;
      background: none;
      color: var(--danger);
      font-size: 13px;
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 999px;
      transition: background 0.12s ease, transform 0.08s ease;
    }

    .delete-btn:hover {
      background: rgba(209, 26, 42, 0.06);
      transform: translateY(-1px);
    }

    .fab {
      position: absolute;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      border-radius: 18px;
      background: var(--accent);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(37, 82, 79, 0.5);
    }

    .fab::before,
    .fab::after {
      content: "";
      position: absolute;
      background: #fff;
      border-radius: 999px;
    }
    .fab::before { width: 26px; height: 2px; }
    .fab::after { width: 2px; height: 26px; }

    .fab:hover {
      transform: translateX(-50%) translateY(-1px);
      box-shadow: 0 14px 32px rgba(37, 82, 79, 0.6);
    }

    .back-link {
      font-size: 14px;
      margin-bottom: 16px;
      cursor: pointer;
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .back-link::before {
      content: "←";
      font-size: 14px;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .log-list {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .log-card {
      background: #ffffff;
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 13px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.05);
    }

    .log-title {
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--accent-strong);
      font-size: 13px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .pill {
      padding: 7px 12px;
      background: var(--pill-bg);
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer;
      border: 1px solid transparent;
      color: var(--text-main);
      transition: background 0.12s ease, border-color 0.12s ease, transform 0.08s ease;
    }

    .pill.selected {
      border-color: var(--pill-border);
      background: #d6ebe8;
      transform: translateY(-1px);
    }
  </style>
</head>
<body>
<div class="phone">

  <!-- HOME -->
  <section class="screen active" id="screen-home">
    <h2>FosterTrack</h2>
    <p>Your foster cats:</p>
    <div class="cat-list" id="cat-list"></div>
    <div class="fab" id="btn-add-cat"></div>
  </section>

  <!-- ADD NEW CAT -->
  <section class="screen" id="screen-add-cat">
    <div class="back-link" data-back="home">Back</div>
    <h2>Add a New Foster Cat</h2>

    <!-- no photo area here anymore -->

    <div class="row">
      <div class="field">
        <label>Name</label>
        <input id="cat-name" type="text" />
      </div>

      <div class="field">
        <label>Status</label>
        <select id="cat-status">
          <option value="In Foster">In Foster</option>
          <option value="Adopted">Adopted</option>
          <option value="Medical Hold">Medical Hold</option>
          <option value="Pending Adoption">Pending Adoption</option>
          <option value="Transferred">Transferred</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="field">
        <label>Intake Date</label>
        <input id="cat-intake" type="date" />
      </div>
      <div class="field">
        <label>Gender</label>
        <select id="cat-gender">
          <option value="Unknown">Unknown</option>
          <option value="Female">Female</option>
          <option value="Male">Male</option>
          <option value="Female (Spayed)">Female (Spayed)</option>
          <option value="Male (Neutered)">Male (Neutered)</option>
        </select>
      </div>
    </div>

    <div class="field">
      <label>Personality</label>
      <div class="pill-row" id="personality-pills"></div>
    </div>

    <div class="field">
      <label>Notes</label>
      <textarea id="cat-notes"></textarea>
    </div>

    <div class="button-row">
      <button class="btn-secondary" data-back="home">Cancel</button>
      <button class="btn-primary" id="btn-save-cat">Save</button>
    </div>
  </section>

  <!-- CAT LOGS -->
  <section class="screen" id="screen-cat-logs">
    <div class="back-link" data-back="home">Back to Cats</div>
    <h2 id="logs-cat-name">Cat</h2>
    <div class="log-list" id="log-list"></div>
    <div class="fab" id="btn-add-log"></div>
  </section>

  <!-- ADD NEW LOG -->
  <section class="screen" id="screen-add-log">
    <div class="back-link" data-back="logs">Back to Logs</div>
    <h2>New Log</h2>

    <div class="field">
      <label>Date</label>
      <input id="log-date" type="date" />
    </div>

    <div class="field">
      <label>Mood</label>
      <div class="pill-row">
        <div class="pill" data-mood="Happy">Happy</div>
        <div class="pill" data-mood="Neutral">Neutral</div>
        <div class="pill" data-mood="Sad">Sad</div>
      </div>
    </div>

    <div class="field">
      <label>Medication</label>
      <div class="pill-row">
        <div class="pill" data-med="Yes">Yes</div>
        <div class="pill" data-med="No">No</div>
      </div>
    </div>

    <div class="field">
      <label>Medication Details</label>
      <input id="log-meds" type="text" />
    </div>

    <div class="field">
      <label>Notes</label>
      <textarea id="log-notes"></textarea>
    </div>

    <div class="button-row">
      <button class="btn-secondary" data-back="logs">Cancel</button>
      <button class="btn-primary" id="btn-save-log">Save</button>
    </div>
  </section>
</div>

<script>
  const state = {
    cats: [],
    currentCatId: null,
    currentLogs: [],
    currentMood: null,
    currentMed: null,
  };

  function showScreen(id) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  /* ---------- Personality pills ---------- */
  const personalityOptions = [
    "Shy","Playful","Relaxed","Independent",
    "Energetic","Affectionate","Curious","Quiet","Vocal","Calm"
  ];
  const personalityPillsContainer = document.getElementById("personality-pills");

  personalityOptions.forEach(option => {
    const pill = document.createElement("div");
    pill.className = "pill";
    pill.textContent = option;
    pill.dataset.personality = option;

    pill.addEventListener("click", () => pill.classList.toggle("selected"));
    personalityPillsContainer.appendChild(pill);
  });

  /* ---------- Data helpers ---------- */
  async function loadCatsFromServer() {
    try {
      const res = await fetch("/cats");
      if (!res.ok) throw new Error("Failed to load cats");
      const cats = await res.json();
      state.cats = cats;
      renderCats();
    } catch (err) {
      console.error(err);
      alert("Failed to load cats from server.");
    }
  }

  async function loadLogsForCurrentCat() {
    if (!state.currentCatId) return;
    try {
      const res = await fetch(`/cats/${state.currentCatId}/logs`);
      if (!res.ok) throw new Error("Failed to load logs");
      state.currentLogs = await res.json();
      renderLogs();
    } catch (err) {
      console.error(err);
      alert("Failed to load logs.");
    }
  }

  /* ---------- Render cats ---------- */
  function renderCats() {
    const container = document.getElementById("cat-list");
    container.innerHTML = "";

    if (!state.cats.length) {
      const empty = document.createElement("p");
      empty.textContent = "No foster cats yet. Tap + to add one.";
      empty.style.color = "#6b7280";
      empty.style.fontSize = "13px";
      container.appendChild(empty);
      return;
    }

    state.cats.forEach(cat => {
      const card = document.createElement("div");
      card.className = "cat-card";

      const personalities = Array.isArray(cat.personality) && cat.personality.length
        ? ` • ${cat.personality.join(", ")}`
        : "";

      card.innerHTML = `
        <div class="thumb">
          <svg viewBox="0 0 64 64" class="cat-icon" aria-hidden="true">
            <path d="M16 10l6 8a18 18 0 0 1 20 0l6-8a2 2 0 0 1 3.4 1.6l-1.4 14A18 18 0 0 1 32 52 18 18 0 0 1 14 25.6L12.6 11.6A2 2 0 0 1 16 10z"/>
            <circle cx="24" cy="30" r="2"/>
            <circle cx="40" cy="30" r="2"/>
            <path d="M28 38c1.3 1.3 2.7 2 4 2s2.7-.7 4-2" stroke="#f9fafb" stroke-width="2" stroke-linecap="round" fill="none"/>
          </svg>
        </div>
        <div>
          <div class="cat-name">${cat.name || "Unnamed"}</div>
          <div class="cat-subinfo">
            ${cat.status || "In Foster"}${cat.gender ? ` • ${cat.gender}` : ""}${
              cat.intakeDate ? ` • ${cat.intakeDate}` : ""
            }${personalities}
          </div>
        </div>
        <button class="delete-btn">Delete</button>
      `;

      // Open logs
      card.addEventListener("click", () => {
        state.currentCatId = cat._id;
        document.getElementById("logs-cat-name").textContent = cat.name || "Cat";
        showScreen("screen-cat-logs");
        loadLogsForCurrentCat();
      });

      // Delete cat
      card.querySelector(".delete-btn").addEventListener("click", async (e) => {
        e.stopPropagation();
        if (!confirm(`Delete ${cat.name || "this cat"} and all its logs?`)) return;
        try {
          const res = await fetch(`/cats/${cat._id}`, { method: "DELETE" });
          if (!res.ok) throw new Error("Delete failed");
          await loadCatsFromServer();
          if (state.currentCatId === cat._id) {
            state.currentCatId = null;
            state.currentLogs = [];
          }
        } catch (err) {
          console.error(err);
          alert("Failed to delete cat.");
        }
      });

      container.appendChild(card);
    });
  }

  /* ---------- Render logs ---------- */
  function renderLogs() {
    const list = document.getElementById("log-list");
    list.innerHTML = "";

    if (!state.currentLogs.length) {
      const empty = document.createElement("p");
      empty.textContent = "No logs yet. Tap + to add one.";
      empty.style.color = "#6b7280";
      empty.style.fontSize = "13px";
      list.appendChild(empty);
      return;
    }

    state.currentLogs.forEach((log, idx) => {
      const card = document.createElement("div");
      card.className = "log-card";

      card.innerHTML = `
        <div class="log-title">Log ${state.currentLogs.length - idx}</div>
        <div>${log.date || ""}</div>
        <div>Mood: ${log.mood || ""}</div>
        <div>Medication: ${log.medication || ""}</div>
        ${log.medicationDetails ? `<div>${log.medicationDetails}</div>` : ""}
        ${log.notes ? `<div>${log.notes}</div>` : ""}
      `;

      list.appendChild(card);
    });
  }

  /* ---------- Add cat flow ---------- */
  document.getElementById("btn-add-cat").addEventListener("click", () => {
    document.getElementById("cat-name").value = "";
    document.getElementById("cat-status").value = "In Foster";
    document.getElementById("cat-intake").value = "";
    document.getElementById("cat-gender").value = "Unknown";
    document.getElementById("cat-notes").value = "";
    document.querySelectorAll("[data-personality]").forEach(p => p.classList.remove("selected"));

    showScreen("screen-add-cat");
  });

  document.getElementById("btn-save-cat").addEventListener("click", async () => {
    const name = document.getElementById("cat-name").value.trim();
    if (!name) {
      alert("Please enter a name.");
      return;
    }

    const selectedPersonalities =
      [...document.querySelectorAll("[data-personality].selected")].map(p => p.dataset.personality);

    const payload = {
      name,
      status: document.getElementById("cat-status").value,
      intakeDate: document.getElementById("cat-intake").value,
      gender: document.getElementById("cat-gender").value,
      notes: document.getElementById("cat-notes").value.trim(),
      personality: selectedPersonalities
      // no photo field anymore
    };

    try {
      const res = await fetch("/cats", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      if (!res.ok) throw new Error("Failed to save cat");
      await loadCatsFromServer();
      showScreen("screen-home");
    } catch (err) {
      console.error(err);
      alert("Failed to save cat");
    }
  });

  /* ---------- Logs flow ---------- */
  document.getElementById("btn-add-log").addEventListener("click", () => {
    if (!state.currentCatId) return;
    state.currentMood = null;
    state.currentMed = null;

    document.querySelectorAll('.pill[data-mood]').forEach(p => p.classList.remove("selected"));
    document.querySelectorAll('.pill[data-med]').forEach(p => p.classList.remove("selected"));

    document.getElementById("log-date").value = "";
    document.getElementById("log-meds").value = "";
    document.getElementById("log-notes").value = "";

    showScreen("screen-add-log");
  });

  document.querySelectorAll('.pill[data-mood]').forEach(pill => {
    pill.addEventListener("click", () => {
      document.querySelectorAll('.pill[data-mood]').forEach(p => p.classList.remove("selected"));
      pill.classList.add("selected");
      state.currentMood = pill.dataset.mood;
    });
  });

  document.querySelectorAll('.pill[data-med]').forEach(pill => {
    pill.addEventListener("click", () => {
      document.querySelectorAll('.pill[data-med]').forEach(p => p.classList.remove("selected"));
      pill.classList.add("selected");
      state.currentMed = pill.dataset.med;
    });
  });

  document.getElementById("btn-save-log").addEventListener("click", async () => {
    if (!state.currentCatId) return;

    const payload = {
      date: document.getElementById("log-date").value,
      mood: state.currentMood,
      medication: state.currentMed,
      medicationDetails: document.getElementById("log-meds").value.trim(),
      notes: document.getElementById("log-notes").value.trim(),
    };

    try {
      const res = await fetch(`/cats/${state.currentCatId}/logs`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      if (!res.ok) throw new Error("Failed to save log");
      await loadLogsForCurrentCat();
      showScreen("screen-cat-logs");
    } catch (err) {
      console.error(err);
      alert("Failed to save log");
    }
  });

  /* ---------- Back links ---------- */
  document.querySelectorAll("[data-back]").forEach(el => {
    el.addEventListener("click", () => {
      const target = el.dataset.back;
      if (target === "home") showScreen("screen-home");
      if (target === "logs") showScreen("screen-cat-logs");
    });
  });

  // Initial load
  loadCatsFromServer();
</script>

</body>
</html>
